<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SWGOH Counter Drag & Drop — Self-contained</title>
<style>
  :root{--gap:12px;--bg:#fafafa;--muted:#666}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial; margin:16px; background:var(--bg); color:#111}
  h3{margin:0 0 8px 0}
  .wrap{display:flex;gap:var(--gap);align-items:flex-start}
  #gallery{width:420px;height:78vh;overflow:auto;border:1px solid #ddd;background:#fff;padding:12px;border-radius:8px;box-shadow:0 1px 3px rgba(0,0,0,.06);display:flex;flex-wrap:wrap;gap:10px;align-content:flex-start}
  .char{width:84px;text-align:center;cursor:grab;user-select:none}
  .char img{width:84px;height:84px;object-fit:cover;border-radius:8px;border:1px solid #eee;display:block;margin:0 auto 6px}
  .char .label{font-size:11px;color:var(--muted);line-height:1.1}
  #panel{flex:1;min-width:360px}
  #drop{height:220px;border:3px dashed #bbb;border-radius:10px;display:flex;align-items:center;justify-content:center;color:var(--muted);background:linear-gradient(180deg,#fff,#fbfbfb)}
  #drop.drag{border-color:#2a9;color:#2a9;background:#f7fff7}
  .team{margin-top:14px;display:flex;gap:10px;flex-wrap:wrap}
  .toon{width:110px;text-align:center}
  .toon img{width:110px;height:110px;object-fit:cover;border-radius:10px;border:1px solid #eee;display:block;margin-bottom:6px}
  .small{font-size:13px;color:var(--muted)}
  footer{margin-top:18px;font-size:12px;color:var(--muted)}
  .note{margin:8px 0 14px 0;color:var(--muted);font-size:13px}
  .controls{display:flex;gap:8px;margin-bottom:10px}
  button{padding:8px 10px;border-radius:8px;border:1px solid #ccc;background:#fff;cursor:pointer}
  button:active{transform:translateY(1px)}
  pre{white-space:pre-wrap;background:#fff;padding:10px;border-radius:8px;border:1px solid #eee;max-height:220px;overflow:auto}
</style>
</head>
<body>
  <h3>SWGOH Counter Finder — Drag a portrait to get the top 5 counter toons</h3>
  <div class="note">This is a fully offline HTML file. Portraits are embedded as data URIs. Replace placeholder images with real PNG base64 data URIs to include actual SWGOH portraits.</div>

  <div class="wrap">
    <div id="gallery" aria-label="Character gallery">
      <!-- Gallery items are injected by script -->
    </div>

    <div id="panel">
      <div class="controls">
        <button id="showAll">Show all names</button>
        <button id="exportMapping">Export counters JSON</button>
      </div>

      <div id="drop">Drop a character image here (or drag from the left gallery)</div>

      <div id="result"></div>

      <div class="note">How it identifies a character: the gallery items carry a <code>slug</code> (unique id). When you drag an item, the slug is transferred and used to look up the top counter team in the <code>counters</code> mapping below.</div>

      <footer>Template: replace placeholder images with PNG base64 data URIs to make this a fully offline portrait gallery.</footer>
    </div>
  </div>

<script>
/*
  Self-contained gallery + drag/drop counter lookup.

  - characters: array of {slug, name, img} where img is a data URI (SVG placeholder here).
  - counters: mapping slug -> array of 5 toon objects {name, img} (img can be data URI or placeholder).
  - To add real portraits: replace the img value with a "data:image/png;base64,..." string for each character.
  - If you want me to generate the full HTML with all characters embedded as PNG base64, ask and I can produce it in parts.
*/

/* -------------------------
   SAMPLE CHARACTERS (placeholders)
   Replace these img values with real PNG base64 data URIs.
   ------------------------- */
const characters = [
  { slug: "rey", name: "Rey", img: `data:image/svg+xml;utf8,${encodeURIComponent(svgPlaceholder('Rey'))}` },
  { slug: "luke-skywalker", name: "Luke Skywalker", img: `data:image/svg+xml;utf8,${encodeURIComponent(svgPlaceholder('Luke'))}` },
  { slug: "darth-vader", name: "Darth Vader", img: `data:image/svg+xml;utf8,${encodeURIComponent(svgPlaceholder('Vader'))}` },
  { slug: "yoda", name: "Yoda", img: `data:image/svg+xml;utf8,${encodeURIComponent(svgPlaceholder('Yoda'))}` },
  { slug: "kylo-ren", name: "Kylo Ren", img: `data:image/svg+xml;utf8,${encodeURIComponent(svgPlaceholder('Kylo'))}` },
  { slug: "ahsoka-tano", name: "Ahsoka Tano", img: `data:image/svg+xml;utf8,${encodeURIComponent(svgPlaceholder('Ahsoka'))}` },
  { slug: "darth-sidious", name: "Darth Sidious", img: `data:image/svg+xml;utf8,${encodeURIComponent(svgPlaceholder('Sidious'))}` },
  { slug: "boba-fett", name: "Boba Fett", img: `data:image/svg+xml;utf8,${encodeURIComponent(svgPlaceholder('Boba'))}` }
];

/* -------------------------
   SAMPLE COUNTERS mapping
   Replace or expand with the top-team counters you want.
   Keys are slugs from characters[]. Values are arrays of 5 toon names (and optional img data URIs).
   ------------------------- */
const counters = {
  "rey": [
    { name: "Bastila Shan (Fallen)", img: `data:image/svg+xml;utf8,${encodeURIComponent(svgPlaceholder('Bastila'))}` },
    { name: "Jedi Knight Revan", img: `data:image/svg+xml;utf8,${encodeURIComponent(svgPlaceholder('Revan'))}` },
    { name: "Grand Admiral Thrawn", img: `data:image/svg+xml;utf8,${encodeURIComponent(svgPlaceholder('Thrawn'))}` },
    { name: "Darth Vader", img: `data:image/svg+xml;utf8,${encodeURIComponent(svgPlaceholder('Vader'))}` },
    { name: "Sith Triumvirate", img: `data:image/svg+xml;utf8,${encodeURIComponent(svgPlaceholder('Sith'))}` }
  ],
  "luke-skywalker": [
    { name: "Rex", img: `data:image/svg+xml;utf8,${encodeURIComponent(svgPlaceholder('Rex'))}` },
    { name: "Ahsoka Tano", img: `data:image/svg+xml;utf8,${encodeURIComponent(svgPlaceholder('Ahsoka'))}` },
    { name: "Hera Syndulla", img: `data:image/svg+xml;utf8,${encodeURIComponent(svgPlaceholder('Hera'))}` },
    { name: "Kanan Jarrus", img: `data:image/svg+xml;utf8,${encodeURIComponent(svgPlaceholder('Kanan'))}` },
    { name: "Ezra Bridger", img: `data:image/svg+xml;utf8,${encodeURIComponent(svgPlaceholder('Ezra'))}` }
  ],
  "darth-vader": [
    { name: "Jedi Knight Revan", img: `data:image/svg+xml;utf8,${encodeURIComponent(svgPlaceholder('Revan'))}` },
    { name: "Bastila Shan (Fallen)", img: `data:image/svg+xml;utf8,${encodeURIComponent(svgPlaceholder('Bastila'))}` },
    { name: "Sith Triumvirate", img: `data:image/svg+xml;utf8,${encodeURIComponent(svgPlaceholder('Sith'))}` },
    { name: "Grand Admiral Thrawn", img: `data:image/svg+xml;utf8,${encodeURIComponent(svgPlaceholder('Thrawn'))}` },
    { name: "Darth Sidious", img: `data:image/svg+xml;utf8,${encodeURIComponent(svgPlaceholder('Sidious'))}` }
  ],
  "yoda": [
    { name: "Darth Sidious", img: `data:image/svg+xml;utf8,${encodeURIComponent(svgPlaceholder('Sidious'))}` },
    { name: "Grand Admiral Thrawn", img: `data:image/svg+xml;utf8,${encodeURIComponent(svgPlaceholder('Thrawn'))}` },
    { name: "Jedi Knight Revan", img: `data:image/svg+xml;utf8,${encodeURIComponent(svgPlaceholder('Revan'))}` },
    { name: "Bastila Shan (Fallen)", img: `data:image/svg+xml;utf8,${encodeURIComponent(svgPlaceholder('Bastila'))}` },
    { name: "Darth Vader", img: `data:image/svg+xml;utf8,${encodeURIComponent(svgPlaceholder('Vader'))}` }
  ]
  // Add more mappings here...
};

/* -------------------------
   Utility: create a simple SVG placeholder with the name
   (Used so the HTML is fully self-contained and visually clear)
   ------------------------- */
function svgPlaceholder(text){
  const w = 256, h = 256;
  const bg = '#e9eef8';
  const fg = '#1f2937';
  const small = text.length > 10 ? 18 : 22;
  return `<svg xmlns='http://www.w3.org/2000/svg' width='${w}' height='${h}' viewBox='0 0 ${w} ${h}'>
    <rect width='100%' height='100%' fill='${bg}' rx='20'/>
    <text x='50%' y='50%' font-family='Arial, Helvetica, sans-serif' font-size='${small}' fill='${fg}' dominant-baseline='middle' text-anchor='middle'>${escapeXml(text)}</text>
  </svg>`;
}
function escapeXml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

/* -------------------------
   Render gallery
   ------------------------- */
const gallery = document.getElementById('gallery');
function renderGallery(){
  gallery.innerHTML = '';
  characters.forEach(c=>{
    const el = document.createElement('div');
    el.className = 'char';
    el.draggable = true;
    el.dataset.slug = c.slug;
    el.innerHTML = `<img src="${c.img}" alt="${c.name}"><div class="label">${c.name}</div>`;
    el.addEventListener('dragstart', e=>{
      // transfer slug and name
      e.dataTransfer.setData('text/slug', c.slug);
      e.dataTransfer.setData('text/name', c.name);
      // also set drag image
      const img = new Image();
      img.src = c.img;
      e.dataTransfer.setDragImage(img, 40, 40);
    });
    gallery.appendChild(el);
  });
}
renderGallery();

/* -------------------------
   Drag/drop handlers for the drop area
   ------------------------- */
const drop = document.getElementById('drop');
const result = document.getElementById('result');

['dragenter','dragover'].forEach(ev => drop.addEventListener(ev, e => { e.preventDefault(); drop.classList.add('drag'); }));
['dragleave','drop'].forEach(ev => drop.addEventListener(ev, e => { e.preventDefault(); drop.classList.remove('drag'); }));

drop.addEventListener('drop', e=>{
  e.preventDefault();
  const slug = e.dataTransfer.getData('text/slug') || '';
  const name = e.dataTransfer.getData('text/name') || slug;
  if(slug) showCountersFor(slug, name);
  else {
    // If user dropped an external file, attempt to infer from filename
    const files = e.dataTransfer.files;
    if(files && files.length){
      const f = files[0];
      const inferred = inferSlugFromFilename(f.name);
      showCountersFor(inferred, f.name);
    } else {
      result.innerHTML = `<p class="small">No character slug found in drop data.</p>`;
    }
  }
});

/* -------------------------
   Show counters for a slug
   ------------------------- */
function showCountersFor(slug, displayName){
  result.innerHTML = '';
  if(!slug){ result.innerHTML = `<p class="small">No slug provided.</p>`; return; }
  const key = slug.toLowerCase();
  const team = counters[key];
  if(!team){
    result.innerHTML = `<p><strong>No counter mapping found for <em>${escapeHtml(displayName || slug)}</em>.</strong></p>
      <p class="small">Add a mapping to the <code>counters</code> object in the HTML to enable this character.</p>`;
    return;
  }
  const header = document.createElement('div');
  header.innerHTML = `<h4 style="margin:8px 0 6px 0">Top team to counter <strong>${escapeHtml(displayName || slug)}</strong></h4>`;
  result.appendChild(header);

  const container = document.createElement('div');
  container.className = 'team';
  team.forEach(t=>{
    const d = document.createElement('div');
    d.className = 'toon';
    d.innerHTML = `<img src="${t.img}" alt="${t.name}"><div style="font-size:13px">${escapeHtml(t.name)}</div>`;
    container.appendChild(d);
  });
  result.appendChild(container);
}

/* -------------------------
   Helpers and UI actions
   ------------------------- */
function inferSlugFromFilename(fn){
  // remove extension and non-alphanum, replace spaces with hyphens
  return fn.replace(/\.[^.]+$/,'').trim().toLowerCase().replace(/[^a-z0-9]+/g,'-');
}
function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

document.getElementById('showAll').addEventListener('click', ()=>{
  // show a quick list of all characters in the gallery
  const names = characters.map(c=>`${c.slug} — ${c.name}`).join('\n');
  alert('Gallery characters:\\n\\n' + names);
});

document.getElementById('exportMapping').addEventListener('click', ()=>{
  // export counters mapping as JSON (string)
  const json = JSON.stringify(counters, null, 2);
  // show in a modal-like pre block
  const w = window.open('', '_blank', 'noopener');
  w.document.write('<pre style="white-space:pre-wrap;font-family:monospace;padding:12px;">' + escapeHtml(json) + '</pre>');
});

/* -------------------------
   Public note:
   - To make this fully offline with real portraits, replace each character.img and each counter.img
     with a PNG base64 data URI: "data:image/png;base64,AAA...".
   - If you want, I can generate the full HTML with every SWGOH character embedded as PNG base64 in parts.
   ------------------------- */
</script>
</body>
</html>
